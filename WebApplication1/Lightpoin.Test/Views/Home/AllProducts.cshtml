@using Lightpoin.Test.Web.Models
@model IEnumerable<ProductModel>
@{
    ViewData["Title"] = "Home Page";
}

<div style="margin-top: 20px;">

    <div class="row">
        <div class="text-center">
            <p style="font-size: 40px;">Products</p>
            <div class="row">
                @{string url = Url.Action();
                    for (int i = url.Length - 1; i > 0; i--)
                    {
                        if (i != '/')
                        {
                            url.Remove(i);

                        }
                        else
                        {
                            break;
                        }
                    } }
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" data-whatever="/Home/AddProduct">Add Product</button>

            </div>
        </div>
    </div>
    <div class="row" style="margin-top: 20px;">
        <table id="ProductTable" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Name</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>

                @{foreach (var product in Model)
                    {

                        <tr>
                            <th>@product.Id</th>
                            <th>
                                @product.Name
                            </th>
                            <th>@product.Description</th>
                        </tr>
                    }
                }
            </tbody>
        </table>
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div id="AddProducts"></div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        $(document).ready(function () {

            $('#ProductTable').DataTable();

            $('#exampleModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                var url = button.data('whatever');

                $('#AddProducts').load(url);
            });
            $('#AddProduct').submit(function (event) {
                event.preventDefault();
                var data = $(this).serialize();
                var url = $(this).attr('action');
                $.post(url, data);
            });

        });
    </script>

    @{await Html.RenderPartialAsync("_ValidationScriptsPartial"); }

}